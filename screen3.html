<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Screen 3 - Mở quà</title>
<style>
    body {
        margin: 0;
        padding: 0;
        background: black;
        overflow: hidden;
        text-align: center;
        color: white;
        font-family: Arial, sans-serif;
    }

    #gift-container {
        position: relative;
        width: 350px;
        height: 350px;
        margin: 100px auto 0 auto;
    }

    #than-hop {
        width: 100%;
        height: auto;
        position: relative;
        top: 10px; /* hạ thân hộp xuống một chút */
        z-index: 1;
    }

    #nap-hop {
        width: 100%;
        height: auto;
        position: absolute;
        top: -90px;
        left: 0;
        transition: transform 1s ease;
        transform-origin: center bottom;
        z-index: 2;
    }

    #anh-qua {
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: auto;
        transform: translate(-50%, -50%);
        transition: width 2s ease;
        z-index: 3;
    }

    #loi-chuc {
        display: none;
        margin-top: 20px;
        font-size: 32px;
        padding: 12px 24px;
        border: 4px solid gold;
        color: red;
        font-weight: bold;
        background-color: #fff5e1;
        display: inline-block;
    }

    #tac-gia {
        position: fixed;
        bottom: 10px;
        right: 10px;
        font-size: 14px;
        color: #ccc;
    }

    canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
    }
</style>
</head>
<body>

<canvas id="fireworks"></canvas>

<div id="gift-container">
    <img id="nap-hop" src="assets/naphop.png" alt="Nắp hộp">
    <img id="than-hop" src="assets/thanhop.jpg" alt="Thân hộp">
    <img id="anh-qua" src="assets/anhqua.jpg" alt="Ảnh quà">
</div>

<div id="loi-chuc">Chúc mừng sinh nhật</div>

<div id="tac-gia">Tác giả: Lộc Thành | 0123456789</div>

<audio id="bg-music" src="assets/music.mp3" autoplay loop></audio>

<script>
    const napHop = document.getElementById("nap-hop");
    const anhQua = document.getElementById("anh-qua");
    const loiChuc = document.getElementById("loi-chuc");
    const bgMusic = document.getElementById("bg-music");

    // ==== Pháo hoa ====
    const canvas = document.getElementById("fireworks");
    const ctx = canvas.getContext("2d");
    let fireworks = [];

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    class Firework {
        constructor(x, y, color) {
            this.x = x;
            this.y = y;
            this.color = color;
            this.particles = [];
            for (let i = 0; i < 50; i++) {
                this.particles.push({
                    x: x,
                    y: y,
                    angle: Math.random() * 2 * Math.PI,
                    speed: Math.random() * 3 + 2,
                    alpha: 1
                });
            }
        }
        update() {
            this.particles.forEach(p => {
                p.x += Math.cos(p.angle) * p.speed;
                p.y += Math.sin(p.angle) * p.speed;
                p.alpha -= 0.02;
            });
            this.particles = this.particles.filter(p => p.alpha > 0);
        }
        draw() {
            this.particles.forEach(p => {
                ctx.globalAlpha = p.alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, 2, 0, Math.PI * 2);
                ctx.fill();
            });
        }
    }

    function loop() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        fireworks.forEach(fw => {
            fw.update();
            fw.draw();
        });
        fireworks = fireworks.filter(fw => fw.particles.length > 0);
        requestAnimationFrame(loop);
    }
    loop();

    function startFireworks(duration = 4000) {
        const colors = ["red", "yellow", "blue", "lime", "pink", "cyan", "orange"];
        let interval = setInterval(() => {
            const x = Math.random() * canvas.width;
            const y = Math.random() * canvas.height / 2;
            fireworks.push(new Firework(x, y, colors[Math.floor(Math.random() * colors.length)]));
        }, 200);
        setTimeout(() => clearInterval(interval), duration);
    }

    // Khi load trang: mở quà tự động
    window.onload = () => {
        // Nắp hộp mở
        setTimeout(() => {
            napHop.style.transform = "rotate(-45deg) translateY(-100px)";
        }, 500);

        // Ảnh quà hiện
        setTimeout(() => {
            anhQua.style.width = "350px";
        }, 1500);

        // Lời chúc xuất hiện sau khi quà mở
        setTimeout(() => {
            loiChuc.style.display = "inline-block";
        }, 3500);

        // Nhạc tự phát
        bgMusic.play().catch(() => console.log("Trình duyệt chặn autoplay"));

        // Pháo hoa chạy
        startFireworks(5000);
    };
</script>

</body>
</html>
