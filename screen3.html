<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Screen 3 - M·ªü qu√†</title>
<style>
    body {
        margin: 0;
        padding: 0;
        background: black;
        overflow: hidden;
        text-align: center;
        color: white;
        font-family: Arial, sans-serif;
    }

    #gift-container {
        position: relative;
        width: 550px;
        height: 550px;
        margin: 100px auto 0 auto;
        z-index: 2;
    }

    #than-hop {
        width: 100%;
        position: relative;
        top: 50px; /* Th√¢n h·ªôp th·∫•p h∆°n */
        z-index: 1;
    }

    #nap-hop {
        width: 100%;
        position: absolute;
        top: -90px;
        left: 0;
        transform-origin: center bottom;
        z-index: 2;
        transition: transform 1s ease;
    }

    #anh-qua {
        position: absolute;
        top: 60%;
        left: 50%;
        width: 0;
        height: auto;
        transform: translate(-50%, -50%);
        transition: width 2s ease;
        z-index: 3;
    }

    #loi-chuc {
        position: absolute;
        top: 75%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.9);
        z-index: 999;
        font-size: 28px;
        padding: 20px 18px;
        border: 4px solid gold;
        color: red;
        font-weight: bold;
        background-color: #fff5e1;
        border-radius: 10px;
        opacity: 0;
        display: none;
        white-space: nowrap;
    }

    #tac-gia {
        position: fixed;
        bottom: 10px;
        right: 10px;
        font-size: 14px;
        color: #ccc;
        z-index: 10;
    }

    #open-btn {
        margin-top: 40px;
        padding: 20px 30px;
        font-size: 30px;
        background: rgb(226, 195, 16);
        color: black;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        z-index: 10;
    }

    canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        pointer-events: none;
    }
</style>
</head>
<body>

<canvas id="fireworks"></canvas>

<div id="gift-container">
    <img id="nap-hop" src="assets/naphop.png" alt="N·∫Øp h·ªôp">
    <img id="than-hop" src="assets/thanhop.jpg" alt="Th√¢n h·ªôp">
    <img id="anh-qua" src="assets/anhqua1.jpg" alt="·∫¢nh qu√†">
</div>

<div id="loi-chuc"></div>

<button id="open-btn">M·ªü qu√†</button>

<div id="tac-gia">editer by  | 0823151088</div>

<audio id="bg-music" src="assets/music.mp3" loop></audio>

<!-- file firework.js ph·∫£i export h√†m/constructor Fireworks nh∆∞ tr∆∞·ªõc -->
<script src="assets/firework.js"></script>
<script>
    const napHop = document.getElementById("nap-hop");
    const anhQua = document.getElementById("anh-qua");
    const loiChuc = document.getElementById("loi-chuc");
    const bgMusic = document.getElementById("bg-music");
    const openBtn = document.getElementById("open-btn");

    // bi·∫øn interval cho loop ph√°o hoa
    let fireworkInterval = null;

    // fallback: n·∫øu browser ch·∫∑n autoplay th√¨ play khi ng∆∞·ªùi d√πng click b·∫•t k·ª≥ l·∫ßn ƒë·∫ßu
    function enableAudioOnFirstInteraction() {
        function tryPlay() {
            bgMusic.play().catch(() => {});
            document.removeEventListener('click', tryPlay);
            document.removeEventListener('keydown', tryPlay);
        }
        document.addEventListener('click', tryPlay, { once: true });
        document.addEventListener('keydown', tryPlay, { once: true });
    }

    // Khi trang load => th·ª≠ play nh·∫°c & ph√°o hoa (v·∫´n c√≥ fallback)
    window.addEventListener('DOMContentLoaded', () => {
        // th·ª≠ autoplay (nhi·ªÅu browser s·∫Ω ch·∫∑n n·∫øu ch∆∞a t∆∞∆°ng t√°c)
        bgMusic.play().catch(() => console.log("Autoplay ch·∫∑n, ch·ªù t∆∞∆°ng t√°c ng∆∞·ªùi d√πng"));
        enableAudioOnFirstInteraction();

        // b·∫Øt ƒë·∫ßu v√≤ng ph√°o hoa ng·∫Øn khi v√†o trang
        loopFireworks(2500); // b·∫≠t 1 ƒë·ª£t, m·ªói 2.5s
        setTimeout(() => stopLoopFireworks(), 8000); // d·ª´ng sau 8s
    });

    // N√∫t m·ªü qu√†
    openBtn.addEventListener("click", () => {
        // N·∫Øp h·ªôp b·∫≠t l√™n
        napHop.style.transform = "rotate(-45deg) translateY(-120px)";

        // Sau khi n·∫Øp b·∫≠t => hi·ªán ·∫£nh qu√†
        setTimeout(() => {
            anhQua.style.width = "700px";

            // Khi ·∫£nh qu√† hi·ªán xong => hi·ªán l·ªùi ch√∫c (g√µ ch·ªØ)
            setTimeout(() => {
                typeWriterEffect("üéâ M√≥n qu√† ƒë·∫∑c bi·ªát nh·∫•t d√†nh cho ƒë·ªùi m ch√≠nh l√† t.ch√∫c m·ª´ng sinh nh·∫≠t üéâ");
            }, 1000);
        }, 600);

        // Ph√°o hoa b·∫Øn li√™n t·ª•c m·∫°nh h∆°n khi m·ªü qu√†
        loopFireworks(1600); // m·ªói 1.6s
        setTimeout(() => stopLoopFireworks(), 10000); // d·ª´ng sau 10s

        // ·∫®n n√∫t m·ªü
        openBtn.style.display = "none";
    });

    // Hi·ªáu ·ª©ng g√µ ch·ªØ
    function typeWriterEffect(text) {
        loiChuc.style.display = "inline-block";
        loiChuc.textContent = "";
        loiChuc.style.opacity = "1";
        loiChuc.style.transform = "translate(-50%, -50%) scale(1)";
        let i = 0;
        const speed = 60; // ms gi·ªØa m·ªói k√Ω t·ª±
        const interval = setInterval(() => {
            loiChuc.textContent += text.charAt(i);
            i++;
            if (i >= text.length) clearInterval(interval);
        }, speed);
    }

    // H√†m kh·ªüi ph√°o hoa (d√πng constructor Fireworks trong file firework.js)
    function startFireworks(duration = 4000) {
        if (typeof Fireworks === "function") {
            // t·∫°o object Fireworks (m·ªói l·∫ßn t·∫°o l√† 1 ƒë·ª£t)
            new Fireworks({
                target: document.getElementById("fireworks"),
                duration: duration
            });
        } else {
            // n·∫øu kh√¥ng c√≥ Fireworks th√¨ kh√¥ng l√†m g√¨ (gi·ªØ an to√†n)
            console.warn("Fireworks constructor kh√¥ng t√¨m th·∫•y.");
        }
    }

    // V√≤ng l·∫∑p ph√°o hoa li√™n t·ª•c
    function loopFireworks(intervalTime = 3000) {
        // n·∫øu ƒë√£ c√≥ interval th√¨ clear tr∆∞·ªõc tr√°nh nh√¢n l√™n
        if (fireworkInterval) clearInterval(fireworkInterval);
        startFireworks(intervalTime);
        fireworkInterval = setInterval(() => {
            startFireworks(intervalTime);
        }, intervalTime);
    }

    function stopLoopFireworks() {
        if (fireworkInterval) {
            clearInterval(fireworkInterval);
            fireworkInterval = null;
        }
    }
</script>

</body>
</html>
